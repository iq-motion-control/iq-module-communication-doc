

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Propeller Motor Control &mdash; Python API 0.11.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/IQClear.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">UART Messaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../langs/arduino.html">Arduino API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../langs/cpp.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../langs/matlab.html">Matlab API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../langs/python.html">Python API</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/vertiq_2306_2200.html">Vertiq 2306 2200KV | Speed Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/vertiq_2306_220.html">Vertiq 2306 220KV | Position Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/vertiq_8108_150.html">Vertiq 8108 150KV | Speed Module</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Python API</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Propeller Motor Control</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/clients/propeller_motor_control.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="propeller-motor-control">
<h1>Propeller Motor Control<a class="headerlink" href="#propeller-motor-control" title="Permalink to this headline">¶</a></h1>
<p>The Propeller Motor Controller is an open and closed loop controller designed to drive propeller loads. If
given thrust coefficients, this controller can be commanded in units of thrust, seamlessly accepting values
from flight controllers in their native units. An added benefit is the decoupling of flight controller gains
from motor choice, propeller choice, battery level, and more. Thrust commands are fed into a PID velocity
controller with a second order polynomial feed forward. This sits on top of a voltage controller, which
compensates for varying input voltages. Finally, the core is a raw PWM controller. Any of the above
controllers can be used by the user.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Propeller Motor Control will timeout and beep 3 times if it hasn’t received a command before the timeout is reached.
You can extend the timeout by changing the timeout client entry</p>
</div>
<div class="section" id="arduino">
<h2>Arduino<a class="headerlink" href="#arduino" title="Permalink to this headline">¶</a></h2>
<p>To use Propeller Motor Controller in Arduino, ensure iq module communication.hpp is included. This allows
the creation of a PropellerMotorControlClient object. See Table 2 for available messages. All message objects
use the Short Name with a trailing underscore. All messages use the standard Get/Set/Save functions.</p>
<p>A minimal working example for the PropellerMotorControlMessaging is:</p>
<div class="highlight-Arduino notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iq_module_communicaiton.hpp&gt;</span><span class="cp"></span>

<span class="n">IqSerial</span> <span class="nf">ser</span><span class="p">(</span><span class="n">Serial2</span><span class="p">);</span>
<span class="n">PropellerMotorControlClient</span> <span class="nf">prop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="kr">void</span> <span class="nb">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ser</span><span class="p">.</span><span class="nf">begin</span><span class="p">();</span>
<span class="p">}</span>

<span class="kr">void</span> <span class="nb">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ser</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">prop</span><span class="p">.</span><span class="n">ctrl_velocity_</span><span class="p">,</span><span class="mf">50.0f</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="c">
<h2>C++<a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h2>
<p>To use Propeller Motor Controller in C++, include propeller motor control client.hpp. This allows the
creation of a PropellerMotorControlClient object. See Table 2 for available messages. All message objects
use the Short Name with a trailing underscore. All messages use the standard Get/Set/Save functions.</p>
<p>A minimal working example for the PropellerMotorControlClient is:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Interfacing with Serial looks different on different machines. Therefore,
this example does not include code for interfacing with the hardware.</p>
<p>For more, see <a class="reference internal" href="../langs/cpp.html#c-full-code"><span class="std std-ref">Full C++ Code Example (w/ LibSerial)</span></a></p>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;generic_interface.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;propeller_motor_control_client.hpp&quot;</span><span class="cp"></span>

<span class="kt">float</span> <span class="n">velocity</span> <span class="o">=</span> <span class="mf">100.0f</span><span class="p">;</span> <span class="c1">// rad/s</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="c1">// Make a communication interface object</span>
    <span class="n">GenericInterface</span> <span class="n">com</span><span class="p">;</span>

    <span class="c1">// Make a Propeller Motor Controller object with obj_id 0</span>
    <span class="n">PropellerMotorControlClient</span> <span class="n">prop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="c1">// Use the Propeller Motor Controller object</span>
    <span class="n">prop</span><span class="p">.</span><span class="n">ctrl_velocity_</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">com</span><span class="p">,</span> <span class="n">velocity</span><span class="p">);</span>

    <span class="c1">// Insert code for interfacing with hardware here</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="matlab">
<h2>Matlab<a class="headerlink" href="#matlab" title="Permalink to this headline">¶</a></h2>
<p>To use Propeller Motor Controller in Matlab, all IQ communication code must be included in your path.
This allows the creation of a PropellerMotorControlClient object. See Table 2 for available messages. All
message strings use the Short Names. All messages use the standard Get/Set/Save functions.</p>
<p>A minimal working example for the PropellerMotorControlClient is:</p>
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Make a communication interface object</span><span class="w"></span>
<span class="n">com</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">MessageInterface</span><span class="p">(</span>’<span class="n">COM18</span>’<span class="p">,</span><span class="mi">115200</span><span class="p">);</span><span class="w"></span>

<span class="c">% Make a PropellerMotorControlClient object with obj_id 0</span><span class="w"></span>
<span class="n">prop</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">PropellerMotorControlClient</span><span class="p">(</span>’<span class="n">com</span>’<span class="p">,</span><span class="n">com</span><span class="p">);</span><span class="w"></span>

<span class="c">% Use the PropellerMotorControlClient object</span><span class="w"></span>
<span class="n">prop</span><span class="p">.</span><span class="n">set</span><span class="p">(</span>’<span class="n">ctrl_velocity</span>’<span class="p">,</span><span class="mf">100.0</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="python">
<h2>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h2>
<p>To use the Propeller Motor Control Client in Python, include <code class="docutils literal notranslate"><span class="pre">iqmotion</span></code> and create a module that has the Propeller Motor Control Client within it’s firmware.
See Table below for available messages. All message strings use the Short Names.
All messages use the standard Get/Set/Save functions.</p>
<p>A minimal working example for the Propeller Motor Control Client is:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">iqmotion</span> <span class="k">as</span> <span class="nn">iq</span>

<span class="n">com</span> <span class="o">=</span> <span class="n">iq</span><span class="o">.</span><span class="n">SerialCommunicator</span><span class="p">(</span><span class="s2">&quot;/dev/ttyUSB0&quot;</span><span class="p">)</span>
<span class="n">vertiq</span> <span class="o">=</span> <span class="n">iq</span><span class="o">.</span><span class="n">vertiq2306</span><span class="p">(</span><span class="n">com</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">vertiq</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;propeller_motor_control&quot;</span><span class="p">,</span> <span class="s2">&quot;ctrl_velocity&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># Supplies 5V to motor</span>
</pre></div>
</div>
</div>
<div class="section" id="message-table">
<h2>Message Table<a class="headerlink" href="#message-table" title="Permalink to this headline">¶</a></h2>
<p>Type ID 52 | Propeller Motor Controller</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 12%" />
<col style="width: 10%" />
<col style="width: 7%" />
<col style="width: 8%" />
<col style="width: 58%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Sub ID</p></th>
<th class="head"><p>Short Name</p></th>
<th class="head"><p>Access</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p class="centered">
<strong>Note</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>ctrl_mode</p></td>
<td><p>get</p></td>
<td><p>int8</p></td>
<td><p>enum</p></td>
<td><p>-1 = no change, 0 = brake, 1 = coast, 2 = pwm, 3 = volts, 4 = velocity, 5 = thrust</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>ctrl_brake</p></td>
<td><p>set</p></td>
<td></td>
<td></td>
<td><p>Shorts motor leads, slows motor down dissipating energy in motor</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>ctrl_coast</p></td>
<td><p>set</p></td>
<td></td>
<td></td>
<td><p>Disables all drive circuitry</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>ctrl_pwm</p></td>
<td><p>get, set</p></td>
<td><p>float</p></td>
<td><p>PWM</p></td>
<td><p>[-1, 1] fraction of input voltage</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>ctrl_volts</p></td>
<td><p>get, set</p></td>
<td><p>float</p></td>
<td><p>V</p></td>
<td><p>[-supply, supply] Voltage to apply to motor</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>ctrl_velocity</p></td>
<td><p>get, set</p></td>
<td><p>float</p></td>
<td><p>rad/s</p></td>
<td><p>Angular velocity command</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>ctrl_thrust</p></td>
<td><p>get, set</p></td>
<td><p>float</p></td>
<td><p>N</p></td>
<td><p>Thrust command (requires kt values)</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>velocity_kp</p></td>
<td><p>get, set, save</p></td>
<td><p>float</p></td>
<td><p>V/(rad/s)</p></td>
<td><p>Proportional gain</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>velocity_ki</p></td>
<td><p>get, set, save</p></td>
<td><p>float</p></td>
<td><p>V/(rad)</p></td>
<td><p>Integral gain</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>velocity_kd</p></td>
<td><p>get, set, save</p></td>
<td><p>float</p></td>
<td><p>V/(rad/s2)</p></td>
<td><p>Derivative gain</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>velocity_ff0</p></td>
<td><p>get, set, save</p></td>
<td><p>float</p></td>
<td><p>V</p></td>
<td><p>Feed forward 0th order term</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>velocity_ff1</p></td>
<td><p>get, set, save</p></td>
<td><p>float</p></td>
<td><p>V/(rad/s)</p></td>
<td><p>Feed forward 1st order term</p></td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p>velocity_ff2</p></td>
<td><p>get, set, save</p></td>
<td><p>float</p></td>
<td><p>V/(rad/s)2</p></td>
<td><p>Feed forward 2nd order term</p></td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
<td><p>propeller_kt_pos</p></td>
<td><p>get, set, save</p></td>
<td><p>float</p></td>
<td><p>N/(rad/s)2</p></td>
<td><p>T = ktω2thrust constant in positive direction</p></td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><p>propeller_kt_neg</p></td>
<td><p>get, set, save</p></td>
<td><p>float</p></td>
<td><p>N/(rad/s)2</p></td>
<td><p>T = ktω2 thrust constant in negative direction</p></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>timeout</p></td>
<td><p>get, set, save</p></td>
<td><p>float</p></td>
<td><p>s</p></td>
<td><p>The controller must receive a message within thistime otherwise it is set to coast mode</p></td>
</tr>
<tr class="row-even"><td><p>16</p></td>
<td><p>input_filter_fc</p></td>
<td><p>get, set, save</p></td>
<td><p>uint32</p></td>
<td><p>Hz</p></td>
<td><p>Low pass cutoff frequency for input commands</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, IQ Motion Control.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>